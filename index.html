<!DOCTYPE html>
<html lang="fr" data-theme="light">
<head>
  <meta charset="UTF-8">
  <title>Ma√Ætre Candice ROVERA - Gestion de Cabinet</title>
  <link rel="stylesheet" href="css/style.css">
</head>
<body>
  <div class="theme-buttons">
    <button id="refreshPageBtn" class="theme-button">
        <span id="refreshIcon">üîÑ</span>
        <span>Actualiser</span>
    </button>
    <button id="themeToggle" class="theme-button">
        <span id="themeIcon">üåû</span>
        <span id="themeText">Mode sombre</span>
    </button>
  </div>
  <div id="loader" class="hidden">Chargement...</div>
  <header>
    <h1>Bienvenue Ma√Ætre Candice ROVERA</h1>
  </header>

  <!-- Section Statistiques + boutons + calendrier + rappels -->
  <div id="statsSection">
    <h2>Statistiques</h2>

    <!-- Contenu mis √† jour par le script -->
    <div id="statsContent">
      <p>Total dossiers : <span id="totalDossiers"></span></p>
      <p>Dossiers archiv√©s : <span id="dossiersArchives"></span></p>
      <p>Montant total : <span id="montantTotalGlobal"></span></p>
    </div>

    <!-- Boutons de vue -->
    <div id="viewSelector">
      <button onclick="switchView('active')" id="btnActive">Dossiers en cours</button>
      <button onclick="switchView('archived')" id="btnArchived">Dossiers archiv√©s</button>
    </div>

    <!-- Calendrier -->
    <div id="calendarArea">
      <h2>Calendrier</h2>
      <div id="calendarContent"></div>
    </div>

    <!-- Rappels des √©ch√©ances -->
    <div id="rappelsSection" style="margin-top: 20px;">
      <h2 style="color: #2980b9;">Rappels √† venir</h2>
      <ul id="listeRappels" style="padding-left: 20px;"></ul>
    </div>
  </div>

  <!-- Conteneur principal -->
  <div id="mainContent" style="display: flex; gap: 30px; align-items: flex-start; flex-wrap: wrap;">

    <!-- Colonne gauche : formulaire -->
    <div id="leftPanel" style="flex: 1; min-width: 300px;">
      <button id="toggleFormBtn" class="primary-button">Ajouter un nouveau client</button>
      <div class="form-container" id="formClient" style="display: none;">
        <h2>Ajouter un nouveau client</h2>
        <input type="hidden" id="indexModif">

        <h3>Informations du client</h3>
        <label>Nom du client :</label>
        <input type="text" id="nom">
        <label>Pr√©nom du client :</label>
        <input type="text" id="prenom">
        <label>Adresse du client :</label>
        <input type="text" id="adresse">
        <label>T√©l√©phone du client :</label>
        <input type="text" id="telephone">
        <label>Email du client :</label>
        <input type="email" id="email">
        <label>Profession du client :</label>
        <input type="text" id="profession">

        <label>Type de dossier :</label>
        <select id="type">
          <option value="">-- S√©lectionner --</option>
          <option value="Premi√®re instance - Divorce">Premi√®re instance - Divorce</option>
          <option value="Premi√®re instance - DCM">Premi√®re instance - DCM</option>
          <option value="Premi√®re instance - Divorce bref d√©lai">Premi√®re instance - Divorce bref d√©lai</option>
          <option value="Premi√®re instance - Requ√™te en fixation des modalit√©s relatives √† l'autorit√© parentale">Premi√®re instance - Requ√™te en fixation des modalit√©s relatives √† l'autorit√© parentale</option>
          <option value="Premi√®re instance - Requ√™te en modification des modalit√©s relatives √† l'autorit√© parentale">Premi√®re instance - Requ√™te en modification des modalit√©s relatives √† l'autorit√© parentale</option>
          <option value="Premi√®re instance - Requ√™te bref d√©lai">Premi√®re instance - Requ√™te bref d√©lai</option>
          <option value="Premi√®re instance - Ordonnance de protection">Premi√®re instance - Ordonnance de protection</option>
          <option value="Premi√®re instance - Requ√™te en d√©l√©gation d'autorit√© parentale">Premi√®re instance - Requ√™te en d√©l√©gation d'autorit√© parentale</option>
          <option value="Appel - Divorce">Appel - Divorce</option>
          <option value="Appel - Divorce bref d√©lai">Appel - Divorce bref d√©lai</option>
          <option value="Appel - Ordonnance de protection">Appel - Ordonnance de protection</option>
          <option value="Appel - Bref d√©lai">Appel - Bref d√©lai</option>
        </select>

        <!-- Nouvelle liste d√©roulante conditionnelle -->
        <div id="roleContainer" style="display: none;">
          <label id="roleLabel">Position :</label>
          <select id="role">
            <option value="">-- S√©lectionner --</option>
            <!-- Les options seront remplies dynamiquement par JavaScript -->
          </select>
        </div>

        <label>Date d‚Äôaudience :</label>
        <input type="date" id="dateAudience">
        <label>Date de dernier contact :</label>
        <input type="date" id="dateContact">
        <label>Date d'entr√©e du dossier :</label>
        <input type="date" id="dateEcheance">

        <label>Aide juridictionnelle :</label>
        <select id="aideJuridictionnelle">
          <option value="non" selected>Non</option>
          <option value="oui">Oui</option>
        </select>

        <label>Tribunal comp√©tent :</label>
        <select id="tribunal">
          <option value="">-- S√©lectionner --</option>
          <option value="Tribunal judiciaire de Paris">Tribunal judiciaire de Paris</option>
          <option value="Tribunal judiciaire de Cr√©teil">Tribunal judiciaire de Cr√©teil</option>
          <option value="Tribunal judiciaire d'Evry">Tribunal judiciaire d'Evry</option>
          <option value="Tribunal judiciaire de Pontoise">Tribunal judiciaire de Pontoise</option>
          <option value="Tribunal judiciaire de Bobigny">Tribunal judiciaire de Bobigny</option>
          <option value="Tribunal judiciaire de Nanterre">Tribunal judiciaire de Nanterre</option>
          <option value="Tribunal judiciaire de Versailles">Tribunal judiciaire de Versailles</option>
          <option value="Tribunal judiciaire d'Auxerres">Tribunal judiciaire d'Auxerres</option>
        </select>

        <label>Commentaire :</label>
        <textarea id="commentaire"></textarea>

        <label>Montant total (HT) :</label>
        <input type="number" id="montantTotal" step="0.01">
        <label>Montant pay√© (HT) :</label>
        <input type="number" id="montantPaye" step="0.01">

        <h3>Informations de l'adverse</h3>
        <label>Nom de l'adverse :</label>
        <input type="text" id="nomAdverse">
        <label>Pr√©nom de l'adverse :</label>
        <input type="text" id="prenomAdverse">
        <label>Adresse de l'adverse :</label>
        <input type="text" id="adresseAdverse">
        <label>T√©l√©phone de l'adverse :</label>
        <input type="text" id="telephoneAdverse">
        <label>Email de l'adverse :</label>
        <input type="email" id="emailAdverse">
        <label>Profession de l'adverse :</label>
        <input type="text" id="professionAdverse">

        <div class="form-group">
          <input type="hidden" id="clientNotes" value="[]">
          <label>Notes rapides :</label>
          <div class="notes-container">
            <div class="notes-list"></div>
            <div class="add-note">
              <input type="text" id="newNote" placeholder="Ajouter une note...">
              <button type="button" onclick="addNote()">+</button>
            </div>
          </div>
        </div>

        <div class="form-group">
          <label>Tags :</label>
          <div class="tags-container">
            <!-- Les tags seront g√©n√©r√©s dynamiquement ici -->
          </div>
        </div>

        <div class="button-group">
          <button id="enregistrerBtn" onclick="ajouterOuModifierClient()" disabled>Enregistrer</button>
          <button id="annulerBtn" onclick="annulerModification()" style="display:none;">Annuler</button>
        </div>
      </div>
    </div>

    <!-- Colonne droite : liste des clients -->
    <div id="rightPanel" style="flex: 1; min-width: 400px;">
      <div class="form-container">
        <h2>Liste des clients</h2>
        <input type="text" id="recherche" placeholder="Rechercher...">
        <select id="tri">
          <option value="">Trier par...</option>
          <option value="nom">Nom</option>
          <option value="type">Type</option>
          <option value="dateAudience">Date d'audience</option>
          <option value="dateEcheance">Date d'entr√©e du dossier</option>
          <option value="dateContact">Date de dernier contact</option>
        </select>
        <button class="action-button" onclick="showEmailConfigModal()">Configurer l'email</button>
      </div>
      <ul id="listeClients"></ul>
      <div id="fiche-detaillee" style="display:none;"></div>
    </div>

    <!-- Explorateur de dossiers -->
    <div id="fileExplorer" class="file-explorer">
      <div class="file-explorer-header">
        <h3>Explorateur de dossiers</h3>
        <div class="file-explorer-actions">
          <button id="newFolderBtn">üìÅ Nouveau dossier</button>
          <button id="openFinanceBtn" class="action-button">
            Gestion financi√®re
          </button>
          <button id="openTableauSuiviBtn" class="action-button">
            Tableau de suivi
          </button>
        </div>
      </div>
      <div class="file-explorer-container">
        <div id="treeView" class="tree-view"></div>
        <div id="fileList" class="file-list"></div>
      </div>
    </div>

  </div>

  <!-- Dans votre modale d'email, ajouter ce champ cach√© -->
  <input type="hidden" id="clientIdForEmail">

  <!-- Modal pour l'envoi d'email -->
  <div id="emailModal" class="modal">
    <div class="modal-content">
      <button class="close-modal" onclick="closeEmailModal()">√ó</button>
      <h2>Envoi d'email</h2>
      <form id="emailForm" onsubmit="sendInvoiceEmail(event)">
        <input type="hidden" id="invoiceNumberForEmail">
        <input type="hidden" id="clientIdForEmail">
        
        <div class="form-group">
          <label for="emailTo">√Ä :</label>
          <input type="email" id="emailTo" required>
        </div>
        
        <div class="form-group">
          <label for="emailSubject">Objet :</label>
          <input type="text" id="emailSubject" required>
        </div>
        
        <div class="form-group">
          <label for="emailMessage">Message :</label>
          <textarea id="emailMessage" rows="10" required></textarea>
        </div>
        
        <div class="form-group checkbox-group" id="attachPDFCheckboxGroup">
          <input type="checkbox" id="attachPDF" checked>
          <label for="attachPDF">Joindre la facture</label>
        </div>

        <div class="form-group" id="attachDocumentBtnGroup" style="display: none;">
          <button type="button" id="attachDocumentBtn" class="btn-secondary">üìé Joindre un document</button>
          <span id="attachedFileName" style="margin-left: 10px; font-style: italic;"></span>
        </div>
        
        <div class="form-actions">
          <button type="button" class="btn-cancel" onclick="closeEmailModal()">Annuler</button>
          <button type="submit" class="btn-primary">Envoyer</button>
        </div>
      </form>
    </div>
  </div>

  <!-- Modal pour la configuration d'email -->
  <div id="emailConfigModal" class="modal">
    <div class="modal-content">
      <button class="close-modal" onclick="closeEmailConfigModal()">√ó</button>
      <h2>Configuration d'email</h2>
      <form id="emailConfigForm" onsubmit="saveEmailConfiguration(event)">
        <div class="form-group">
          <label for="configEmail">Adresse email Gmail:</label>
          <input type="email" id="configEmail" required>
        </div>
        
        <div class="form-group">
          <label for="configAppPassword">Mot de passe d'application:</label>
          <input type="password" id="configAppPassword" required>
          <p class="help-text">
            <small>Ce n'est pas votre mot de passe Gmail habituel. Vous devez g√©n√©rer un mot de passe d'application dans les param√®tres de s√©curit√© de votre compte Google.</small>
            <a href="#" onclick="openGoogleAppPasswordPage()">Voir comment faire</a>
          </p>
        </div>
        
        <div class="form-actions">
          <button type="submit" class="btn-primary">Enregistrer</button>
        </div>
      </form>
    </div>
  </div>

  <footer>
    Ma√Ætre Candice ROVERA - Avocate au Barreau de Paris
  </footer>

  <!-- √Ä la fin du document, juste avant la fermeture de body -->

  <!-- D'abord charger la configuration -->
  <script src="js/email-config.js"></script>
  <!-- Ensuite charger le gestionnaire d'email qui utilise cette configuration -->
  <script src="js/email-manager.js"></script>
  <!-- Finalement, charger le reste des scripts -->
  <script src="renderer.js"></script>
</body>
</html>